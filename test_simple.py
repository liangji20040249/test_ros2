import os

# ==========================================
# 1. æ ¸å¿ƒæ¶æ„ä¿®æ­£ï¼šé€šè¿‡ç¯å¢ƒå˜é‡å¼ºåˆ¶ç»‘å®š 0.0.0.0
# ==========================================
# åœ¨å¯¼å…¥ rerun ä¹‹å‰è®¾ç½®ï¼è¿™æ¯”ä»»ä½•ä»£ç å‚æ•°éƒ½ç®¡ç”¨ã€‚
# è¿™å‘Šè¯‰ Rerunï¼šä¸ç®¡ä½ æ€ä¹ˆæƒ³ï¼Œå¿…é¡»ç»™æˆ‘ç›‘å¬æ‰€æœ‰ç½‘å¡ï¼Œä¸è¦åªå¬ 127.0.0.1
os.environ["RERUN_BIND"] = "0.0.0.0"

# å¼ºåˆ¶æŒ‡å®š WebSocket ç«¯å£ï¼Œé˜²æ­¢éšæœºè·³åŠ¨
# æ³¨æ„ï¼šWeb Viewer é»˜è®¤æ‰¾ web_port + 1ï¼Œæ‰€ä»¥å¦‚æœ webæ˜¯9876ï¼Œè¿™é‡Œå¿…é¡»æ˜¯9877
os.environ["RERUN_WS_SERVER_PORT"] = "9877"

import rerun as rr
import time
import math

# ==========================================
# 2. å¯åŠ¨æœåŠ¡ (å•è¿›ç¨‹æ¨¡å¼)
# ==========================================
# åˆå§‹åŒ–
rr.init("test_simple", spawn=False)

print("ğŸš€ [ç³»ç»Ÿ] å¯åŠ¨ Rerun Web Server (ä¸€ä½“åŒ–æ¨¡å¼)...")
print("ğŸŒ è¯·åœ¨ Mac æµè§ˆå™¨è®¿é—®: http://localhost:9876/?url=ws://localhost:9877")

# å¯åŠ¨ Web æœåŠ¡
# å› ä¸ºæˆ‘ä»¬è®¾äº†ç¯å¢ƒå˜é‡ï¼Œè¿™é‡Œä¸éœ€è¦ä¼ å¤æ‚å‚æ•°ï¼Œåªè¦æŒ‡å®š web ç«¯å£
rr.serve_web_viewer(web_port=9876, open_browser=False)

# ==========================================
# 3. ä¸šåŠ¡å¾ªç¯
# ==========================================
print("â–¶ï¸ å¼€å§‹äº§ç”Ÿæ•°æ®...")
start_time = time.time()

try:
    while True:
        elapsed = time.time() - start_time
        
        # æ¨¡æ‹Ÿæ­£å¼¦æ³¢
        sin_val = math.sin(elapsed)
        
        # è®°å½•æ•°æ® (æœ¬åœ°å†…å­˜ç›´æ¥æµè½¬ï¼Œä¸éœ€è¦ connectï¼)
        rr.log("my_curve", rr.Scalars([sin_val]))
        
        print(f"ğŸ“¡ è®°å½•æ•°æ®: {sin_val:.2f}", end="\r")
        time.sleep(0.1)

except KeyboardInterrupt:
    print("\nğŸ›‘ åœæ­¢")